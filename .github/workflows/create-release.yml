# .github/workflows/create-release.yml

# å·¥ä½œæµåç§°
name: Create and Publish Release

# è§¦å‘æ¡ä»¶
on:
  push:
    tags:
      - 'v*.*.*'

# å®šä¹‰å·¥ä½œæµä¸­çš„ä»»åŠ¡
jobs:
  create-release:
    # ä»»åŠ¡åç§°
    name: Create Release Package
    # è¿è¡Œç¯å¢ƒ
    runs-on: ubuntu-latest
    # æˆäºˆå†™å…¥æƒé™
    permissions:
      contents: write

    # ä»»åŠ¡æ­¥éª¤
    steps:
      # ç¬¬ 1 æ­¥ï¼šæ£€å‡ºä»“åº“ä»£ç 
      - name: Checkout repository
        uses: actions/checkout@v4

      # ç¬¬ 2 æ­¥ï¼šå‡†å¤‡å˜é‡ (æ–¹ä¾¿è‡ªå®šä¹‰)
      - name: Set up release variables
        run: |
          # æå–ç‰ˆæœ¬å· (ä¾‹å¦‚ä» "v1.2.3" å¾—åˆ° "1.2.3")
          VERSION=$(echo ${{ github.ref_name }} | sed 's/v//')
          # ğŸš€ åœ¨è¿™é‡Œå®šä¹‰ä½ çš„å‹ç¼©åŒ…æ–‡ä»¶åå‰ç¼€
          ASSET_NAME_PREFIX="VpsScriptKit"
          # ç»„åˆæˆæœ€ç»ˆçš„å‹ç¼©åŒ…æ–‡ä»¶å
          echo "ASSET_NAME=${ASSET_NAME_PREFIX}-${{ github.ref_name }}.tar.gz" >> $GITHUB_ENV

      # ç¬¬ 3 æ­¥ï¼šä½¿ç”¨ git archive åˆ›å»ºå‘è¡ŒåŒ…
      - name: Create release archive
        run: git archive -o ${{ env.ASSET_NAME }} --format=tar.gz HEAD
      
      # ç¬¬ 4 æ­¥ï¼šåˆ›å»ºå¸¦ç‰ˆæœ¬å·çš„ Release
      - name: Create Versioned Release
        uses: softprops/action-gh-release@v2
        with:
          tag_name: ${{ github.ref_name }}
          # Release çš„æ ‡é¢˜ç›´æ¥ä½¿ç”¨ç‰ˆæœ¬å·
          name: ${{ github.ref_name }}
          # ğŸš€ è¿™æ˜¯ Release çš„æè¿°å†…å®¹
          body: "VpsScriptKit é¡¹ç›®ï¼Œç®€ç§° vsk é¡¹ç›®ã€‚"
          files: ${{ env.ASSET_NAME }}
          prerelease: ${{ contains(github.ref, '-') }}
